# 課題2
https://github.com/tamamura3/praha-challenge-templates/blob/master/jestSample/\_\_tests__/functions.test.ts'
# 課題3
## 依存性の注入について
プログラムが外部のリソース（DB、APIなど）に依存している場合、外部のリソースの実行結果により、プログラムの実行結果が変化してしまう。  
例えば、プログラムの中でDBからの取得処理がある場合、データが違えば、実行結果が成功にも失敗にもなることがある。そうするとテスト結果が安定しないので、カバレッジ100%のテストが作れなくなる。

この問題を解決するには、外部リソースの処理を疑似的に作成し結果を固定する方法がある。それをテストしたい関数に引数で渡すなどして利用することで、外部依存部分の結果を安定させ、結果的にテスト結果も安定するのでカバレッジ100%のテストが書ける。

このように外から外部依存部分を渡す方法を「依存性の注入」という。
依存性の注入を行うと、モジュール同士の結合度が弱くなる。

## 外部サービスとの通信
単体テストで外部サービスと通信が発生すると、テスト結果が外部サービスの実行結果に依存してしまう。
そうすると、テスト結果が安定しないので、カバレッジ100%のテストが書けなくなる。例えば一時的に外部サービスが止まっていて、製品コードが問題ないのにテストが失敗するなど。

そのため、単体テストでは外部サービスとの通信を避けた方が良い。
外部サービスを動かしてプログラム全体をテストするのは統合テストのような後ろのフェーズでよいと考える。

## sumOfArrayの修正
reduceの初期値に0を与え、空の配列の場合は0を返すように修正。
併せてテストの期待値を0で比較するように修正。

## Property Based testingとは
Property Based Testingは専用のツールを使用してより網羅的にテストをする仕組み。
例えば「一つの自然数」という性質（property）を定義すれば、性質に当てはまるありとあらゆる入力値が自動的に作成されテストされる。（1、33、738470107など）
その入力値をテスト対象の関数に渡してテストすれば、人より網羅的にテストができ、コード品質の向上に繋がる。

反対にExample Based Testingという言葉があり、これは多くの人がいつもやっている、数ある入力値からいくつかを選出してテストする方法。

Property Based Testingを使用しない方が良いケースがあるとすれば、一回の実行に時間がかかる処理が考えられる。

## 単体テストでの工夫
- Arrenge-Act-Assert
テストコードを3段階に分けてコメントして管理することで、どこで何をしているか、何のテストをしているかを理解しやすくする方法。Arrengeでは入力値や初期化など、テストに必要なデータを準備する。Actでは、関数やAPIなどテスト対象の実行を行う。Assertでは結果を判定する。
- 一つのユニットテストに複数assertを書かない
一つのユニットテストで複数のassertを実行すると、エラー時にそれ以降のテストが実行されないので注意。
- テスト内にロジックを書かない
テストの中にロジックを書くと、そのロジックにバグが生まれる可能性があるので、極力避ける。
if, for, whileなどを使うようであれば注意し、必要であれば複数のテストケースに分ける。
参考：https://www.simform.com/blog/unit-testing-best-practices/

# 課題4
## テストを書いてみよう（関数3つ）
[functions.ts](https://github.com/tamamura3/praha-challenge/blob/main/test/1_test_jest/functions.ts)、[addressApiService.ts](https://github.com/tamamura3/praha-challenge/blob/main/test/1_test_jest/addressApiService.ts)を参照。

## jestに関するクイズ
1. オブジェクトの等価を判定するmatcharのtoBeとtoEqualの違いは？
2. expect()がない場合のテスト結果はどうなる？
3. 実行結果のFile, Stmts, Branch, Funcs, Lines, Uncoverd Lineはそれぞれ何を意味してる？

# 課題5
- テストの名前には「～されるかどうか」のようなテスト観点を書くとわかりやすいと感じた。
例：「[]の配列を引数に渡した場合」×
　　「空配列の場合0が返却されるかどうか」〇
- テスト実行前にbeforeEachなどでスナップショットを取り、完了後afterEachでスナップショットを戻せば常に同じ状態で各テストを実行できる

参考：https://github.com/PostHog/posthog
https://github.com/n8n-io/n8n
