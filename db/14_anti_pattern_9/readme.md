# 課題1

## 1. mailAddressのカラムに対してCheckでドメインの制約をする
以下の理由でこのケースではCheck制約は使わない方が良いと考える。
- DBにロジックが含まれることで、変更時にDBを更新するコストがかかる、デバッグしにくい、存在に気づきにくいなどデメリットがある

将来的に対象のドメインが変更されることも考えられるので、ロジックはプログラムにまとめた方がメンテナンスのコストが低いと思う。
メールアドレスの制約はフロントの入力画面でリアルアイムで行うなどした方がUXとしては良さそう。
  
Check制約を利用した方がいいケースがあるとすれば、運用上手動でinsertするケースがあるなど、アプリを介さない可能性がある場合が考えられる。

## 2. 削除ユーザーのデータ移動をtriggerで行う
以下の理由でこのケースではtriggerは使わない方が良いと考える。
- DBにロジックが含まれることで、変更時にDBを更新するコストがかかる、デバッグしにくい、存在に気づきにくいなどデメリットがある

1と異なりDBだけ処理が完結するので、triggerの存在を知らなければ「どこで更新されてるの？」となりそう。
プログラムで制御した方がメンテナンスコストしやすいと思う。
  
調べたところ、triggerを使うケースとしては
- 参照整合性を保つ場合。例えばユーザー削除時に関連するデータも削除するなど
- DBの更新履歴を残す場合。例えばあるテーブル更新時に、更新時間などの情報をauditテーブルに追加するなど
- サマリ系のカラムを更新する場合。例えばtotal_priceのようなカラム

のような実行の契機がDB内の場合が考えられるとのこと。ただアプリでも実装できるので、どちらが良いかはケースバイケースだと思う。
  
https://www.techmixing.com/2018/11/advantages-disadvantages-of-sql-trigger.html  
https://www.ibm.com/docs/en/informix-servers/14.10?topic=triggers-when-use

## 3. genderカラムに入る値をenumで制約すべきか
以下の理由でこのケースではenumを使わない方が良いと考える
- DBにロジックが含まれることで、変更時にDBを更新するコストがかかる、デバッグしにくい、存在に気づきにくいなどデメリットがある

genderは仕様的に変更する可能性があるので、enumよりマスタテーブルを作りそれを参照する方が変更に強い設計になると思う。
enumを使った方がいいケースは思い浮かばなかった。

https://shiro-secret-base.com/?p=928

## 4. postCodeカラムに特定形式しか入れないようDomainで制約すべきか
以下の理由でこのケースではDomainを使って良いと考える。
- 郵便番号の形式が変更することは少ないため

郵便番号の形式は頻繁に変わるものではないので、Domainの変更コストというデメリットより、値を担保できるメリットの方が上回りそう。
商品番号の形式のような変更が見込まれるロジックはDomainで制約しない方が良い。

https://nuko-yokohama.hatenadiary.org/entry/20111210/1323463137

## 所感
DBで制約すれば最後の砦的な感じでデータの保証はほぼ確実にできる。
ただし、そもそもDBは値を保存する場所なので、ビジネスロジックを持たせるとその役割とずれてしまう。
プログラムとDBにロジックが散在すると、メンテナンスが大変（ロジックの重複、DBの制約に気づきにくい、DBの制約変更にコストかかる）。
制約は、まずはプログラムで実装することを検討した方が良さそう。
その上で、次の例のようにDBで制約した方がメリットがある場合はそれを検討する。
- データの更新をauditテーブルに逐一保存したい
→プログラムだと呼び出し箇所が多くなってしまうので、DBにtriggerを持たせて処理をまとめることでメンテナンスが楽に
- 郵便番号の形式を制限したい
→プログラムでもできるが、近い将来の変更が見込まれないのでDBに制約を付けることで強く保証できる

# 課題2
- タスク管理アプリを作っている。削除したタスクを一定時間復活させられるように、タスク削除時にデータをdeletedTasksテーブルにinsertしたい。これをtriggerで行おうとしてアンチパターンに陥る
